@inject ISessionStorageService SessionStorage;
@page "/reservation"
@using MeetNSeat.Client.Models
@using MeetNSeat.Client.Services
@using MeetNSeat.Client.Utils
@using Blazored.SessionStorage
@attribute [Authorize]
@inject IJSRuntime JsRuntime;

<main role="main" class="col-md-12 ml-sm-auto col-lg-12 px-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2>Create reservation</h2>
    </div>
    <div>
        <form>
            <div class="mb-3">
                <label for="Location" class="form-label">Location</label>
                <select class="form-control" @bind="Location" @bind:event="oninput" aria-label="Default select example">
                    <option disabled selected placeholder="Select a location here">Select a location</option>
                    <option value="1">Eindhoven</option>
                    <option value="2">Sommeren</option>
                    <option value="3">Maaskantje</option>
                </select>

                <label for="Room" class="form-label">Room type</label>
                <select class="form-control" @bind="Room" @bind:event="oninput" aria-label="Default select example">
                    <option disabled selected placeholder="Select a location here">Select a room type</option>
                    <option value="1">Conference</option>
                    <option value="2">Workplace</option>
                </select>

                <label for="Attendees" class="form-label">Attendees</label>
                <input type="number" class="form-control" id="Attendees" placeholder="Attendees">
                <input type="datetime-local" @bind="@StartDate" @bind:format="yyyy-MM-ddTHH:mm" />
                <input type="datetime-local" @bind="@EndDate" @bind:format="yyyy-MM-ddTHH:mm" />
            </div>
            <button @onclick="AddReservation" type="button" disabled="@IsDisabled" class="btn btn-primary">Maak reservering</button>
        </form>
    </div>
</main>

@code {
    private int Location { get; set; }

    private int Room { get; set; }

    private bool IsDisabled { get; set; } = false;


    private DateTime StartDate { get; set; }
    private DateTime EndDate { get; set; }

    private async Task AddReservation()
    {
        if (StartDate >= DateTime.Now)
        {
            var userId = await SessionStorage.GetItemAsync<string>("userId");
            await UserService.CreateReservation(new ReservationModel(userId, Location, Room, StartDate, EndDate));
        }
        else
        {
            // show message.
            var alert = await JsRuntime.InvokeAsync<string>("alert", "Can't schedule reservation in the past.");

            // prevent form from submitting to form.
            return;
        }
    }


}
